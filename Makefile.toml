[tasks.run]
command = "cargo"
args = ["run"]

[tasks.clean_html]
command = "find"
args = [".", "-name", "*.html", "-delete"]

[tasks.dockerbuild]
command = "docker"
args = ["build", "-t", "algotrap:latest", "-f", "deployment/Dockerfile", "."]

[tasks.dockerrun]
dependencies = ["dockerbuild"]
command = "bash"
args = ["-c", """
  if [ ! -f .env ]; then
    echo 'Error: .env file not found.';
    exit 1;
  fi;
  docker run --rm --env-file .env algotrap
"""]

[tasks.k8s-deploy]
command = "bash"
args = ["-c", """
  ./deployment/generate_secret.sh && \
  kubectl apply -f k8s/ && \
  kubectl get cronjob algotrap-cronjob && \
  kubectl get secret algotrap-secrets
"""]

[tasks.trigger-nightly-workflow]
command = "gh"
args = ["workflow", "run", "nightly.yml"]
